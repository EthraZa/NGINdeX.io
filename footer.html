</div>
<!--<footer>Powered by <a href="https://github.com/ccarney16/nginx-autoindex">nginx-autoindex</a></footer>-->
<footer><a href="/#"><span class="glyphicon glyphicon-road"></span></a></footer>

<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"></script>
<script src="/autoindex/js/bootstrap.min.js"></script>
<script src="/autoindex/js/jquery.tableSorter.js"></script>

<script type="text/javascript">
	var configFile = "config.json"; //Allows webmasters to design the site with a simple config file
	var defaultConfig = "/autoindex/default.json"; //fall back to this config if uneable to be read

	$(document).ready(function(){
		$("#file-search").on("keyup", function() {
			var value = $(this).val().toLowerCase();
			if (value.length == 0 || value.length >= 3) {
				$("#file-table tbody tr").filter(function() {
					$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
				});
			}
		});
	});

	$('#page-header').html('<span class="glyphicon glyphicon-folder-open"></span>&nbsp;&nbsp;&nbsp;<small>' + window.location.pathname + '</small>');
	if (window.location.pathname.endsWith('.html')) { alert('WARNING! Strange setup detected, this page may not work (Did you correctly configure nginx correctly?)'); }
	$('#parent-link').html('<a href="' + getParent(window.location.pathname) +'"><span class="glyphicon glyphicon-level-up"></span> ' + getParent(window.location.pathname).split('/').slice(-2).shift() + '/' + '</a>');

	document.addEventListener('DOMContentLoaded', function() {
        	//lets load the json object.
		let json = JSON.parse($('#json-output').text());
		var tblhtml = $('#file-table').html();

		for (let entry of json) {
			let mtime = new Date(entry.mtime);
			entry.mtime = mtime.toLocaleDateString() + ' ' + mtime.toLocaleTimeString();

			if (entry.type == "directory") {
				tblhtml += '<tr><td><a href="' + window.location.pathname + '' + entry.name + '/"><span class="glyphicon glyphicon-folder-open"></span>&nbsp;&nbsp;&nbsp;' + entry.name + '</a></td><td>' + entry.type + '</td><td>' + entry.mtime + '</td><td></td></tr>';
			} else if (entry.type == 'file') {
				tblhtml += '<tr><td><a href="' + window.location.pathname + '' + entry.name +'"><span class="glyphicon glyphicon-file"></span>&nbsp;&nbsp;&nbsp;' + entry.name + '</a></td><td>' + entry.type + '</td><td>' + entry.mtime + '</td><td>' + humanFileSize(entry.size, true, 2) +  '</td></tr>';
			}
		}
		$('#file-table').html(tblhtml);
		$('#file-table').tableSortable();
		$('.bg_load').delay(1500).hide('slow');
		$('.wrapper').delay(1500).hide('slow');
	});

	//Gets the parent directory from the documents pathname
	function getParent(path) {
		var _split = path.split('/');
		_split = _split.slice(0, _split.length -2);
		return _split.join('/') + '/';
	}

	/**
	 * Format bytes as human-readable text.
	 * 
	 * @param bytes Number of bytes.
	 * @param si True to use metric (SI) units, aka powers of 1000. False to use 
	 *           binary (IEC), aka powers of 1024.
	 * @param dp Number of decimal places to display.
	 * 
	 * @return Formatted string.
	 */
	function humanFileSize(bytes, si=false, dp=1) {
		const thresh = si ? 1000 : 1024;

		if (Math.abs(bytes) < thresh) {
			return bytes + ' B';
		}
	
		const units = si 
		 ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'] 
		 : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];
		let u = -1;
		const r = 10**dp;
	
		do {
			bytes /= thresh;
			++u;
		} while (Math.round(Math.abs(bytes) * r) / r >= thresh && u < units.length - 1);
		
		return bytes.toFixed(dp) + ' ' + units[u];
	}
</script>
</body>
</html> 
